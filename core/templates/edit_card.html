{% extends "base.html" %}
{% block content %}
<h1 class="text-2xl font-bold mb-6">Editar Cartão de Crédito</h1>

<form method="post" class="space-y-6">
  {% csrf_token %}

  <div>
    <label class="block font-semibold mb-2">Nome do Cartão</label>
    <input type="text" name="name" value="{{ cartao.name }}" class="w-full border rounded-md p-3" required>
  </div>

  <div class="grid grid-cols-2 gap-4">
    <div>
      <label class="block font-semibold mb-2">Dia de Fechamento</label>
      <input type="number" name="closing_day" min="1" max="31" value="{{ cartao.closing_day }}" class="w-full border rounded-md p-3" required>
    </div>

    <div>
      <label class="block font-semibold mb-2">Dia de Vencimento</label>
      <input type="number" name="due_day" min="1" max="31" value="{{ cartao.due_day }}" class="w-full border rounded-md p-3" required>
    </div>
  </div>

  <div>
    <label class="block font-semibold mb-2">Limite</label>
    <input type="text" name="limit" value="R$ {{ cartao.limit|floatformat:2 }}" class="w-full border rounded-md p-3" id="limiteInput" required>
  </div>

  <div class="flex space-x-4">
    <button type="submit" class="px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700">
      Salvar Alterações
    </button>
    <a href="{% url 'cards' %}" class="px-6 py-3 bg-gray-500 text-white rounded-md hover:bg-gray-600">
      Cancelar
    </a>
  </div>
</form>

<script>
  // Script de formatação para o campo de limite
  const limiteInput = document.getElementById('limiteInput');

  function formatarMoeda(valor) {
    let numero = parseFloat(valor);
    if (isNaN(numero)) numero = 0;
    return new Intl.NumberFormat('pt-BR', {
      style: 'currency',
      currency: 'BRL',
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    }).format(numero);
  }

  limiteInput.addEventListener('input', function (e) {
    let valor = e.target.value.replace(/\D/g, '');
    if (!valor) {
      e.target.value = formatarMoeda(0);
      return;
    }
    let numero = parseInt(valor, 10) / 100;
    e.target.value = formatarMoeda(numero);
  });

  limiteInput.addEventListener('blur', function (e) {
    if (!e.target.value.trim() || e.target.value === 'R$ 0,00') {
      e.target.value = formatarMoeda(0);
    } else {
      let valor = e.target.value.replace(/\D/g, '');
      let numero = parseInt(valor, 10) / 100;
      e.target.value = formatarMoeda(numero);
    }
  });

  limiteInput.addEventListener('focus', function (e) {
    e.target.select();
  });
</script>
{% endblock %}